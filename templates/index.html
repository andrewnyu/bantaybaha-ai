{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bantay Baha Agent MVP</title>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <link rel="stylesheet" href="{% static 'css/style.css' %}" />
</head>
<body>
  <header class="topbar">
    <div class="topbar-inner">
      <span class="brand">Bantay Baha Agent</span>
      <span class="subtitle">Flood Early Warning Â· Negros Island</span>
    </div>
    <nav class="tab-nav">
      <a class="tab-link active" href="#" data-tab="home">Home</a>
      <a class="tab-link" href="#" data-tab="demo">Demo Weather (For Testing)</a>
    </nav>
    <p>Tap the map, check flood risk, then use chat for evacuation and routing questions.</p>
  </header>

  <main class="layout">
    <section class="map-panel">
      <div class="map-controls">
        <div class="map-search-row">
          <input
            id="locationSearchInput"
            type="text"
            placeholder="Search place in Negros..."
            autocomplete="off"
            aria-label="Search location"
          />
          <button id="locationSearchBtn" type="button">Search</button>
          <button id="myLocationBtn" type="button" class="secondary-btn">My Location</button>
        </div>
        <div id="selectedLocationLabel" class="selected-location-label">Barangay: n/a, City: n/a</div>
      </div>
      <div id="map"></div>
    </section>

    <section class="control-panel">
      <section class="tab-panel active" data-tab-panel="home">
        <div class="card google-card chat-card" id="chatCard" data-openai-configured="{{ openai_configured|yesno:'1,0' }}">
          <div class="status-flags" id="statusFlags"></div>
          <h2>Flood Assistant</h2>
          <div id="weatherModeIndicator" class="weather-mode-chip live" role="status" aria-live="polite">
            Live OpenWeather forecast
          </div>
          <p class="chat-hint">
            You can chat in English, Tagalog, Cebuano, or Ilonggo (default English).
          </p>
          <div id="chatLog" class="chat-log"></div>
          <div class="chat-suggestions" id="chatSuggestions">
            <button type="button" class="chat-suggestion" data-message="check risk">
              Check flood risk
            </button>
            <button type="button" class="chat-suggestion" data-message="Find nearest evacuation center.">
              Nearest evacuation center
            </button>
            <button type="button" class="chat-suggestion" data-message="Show safe route to nearest evacuation center.">
              Safe route to nearest center
            </button>
            <button type="button" class="chat-suggestion" data-message="Show fastest route to nearest evacuation center.">
              Fastest route to nearest center
            </button>
          </div>
          <form id="chatForm" class="chat-composer">
            <input id="chatInput" type="text" placeholder="Ask for check risk, nearest center, safe route..." />
            <button id="chatSendBtn" type="submit" class="send-btn">Send</button>
          </form>
        </div>
      </section>

      <section class="tab-panel" data-tab-panel="demo">
        <div class="card settings-card">
          <h2>Demo Weather (For Testing)</h2>
          <p id="demoWeatherContext" class="muted demo-context">Set weather scenario for selected location.</p>
          <div class="settings-row">
            <label class="settings-toggle" for="demoWeatherToggle">
              <input id="demoWeatherToggle" type="checkbox" />
              Enable demo weather mode
            </label>
            <div class="settings-inline-actions">
              <button id="generateUpstreamNodesBtn" type="button" class="secondary-btn">
                Generate upstream nodes
              </button>
              <button id="clearDemoRainfallBtn" type="button" class="secondary-btn">Clear</button>
            </div>
          </div>
          <label class="muted" for="demoHoursInput">Forecast window (hours)</label>
          <input
            id="demoHoursInput"
            type="number"
            min="1"
            max="6"
            step="1"
            value="3"
            aria-label="Demo forecast window"
          />
          <label class="muted" for="demoScenarioSelect">Quick scenarios</label>
          <select id="demoScenarioSelect">
            <option value="custom">Custom (manual)</option>
            <option value="high_rain">High rain (typhoon level)</option>
            <option value="medium_rain">Medium rain</option>
            <option value="no_rain_high_upstream">No rain, high upstream rain</option>
          </select>
          <label class="muted" for="demoRainfallInput">Manual rainfall series (mm/hr)</label>
          <input
            id="demoRainfallInput"
            type="text"
            placeholder="10,22,45,30,12,5"
            maxlength="120"
            aria-label="Manual hourly rainfall"
          />
          <p class="muted settings-helper">
            Enter up to 6 hourly rainfall values. Missing hours are padded with 0.
            Empty input uses all zeros.
          </p>
          <label class="muted" for="demoUpstreamWeatherInput">
            Upstream node weather (optional)
          </label>
          <textarea
            id="demoUpstreamWeatherInput"
            rows="5"
            placeholder='[{"lat": 9.12345, "lng": 122.56789, "demo_rainfall": "50,40,30"}]'
          ></textarea>
          <p class="muted settings-helper">
            Use JSON array of upstream nodes and rainfall. Leave blank for shared global demo rainfall.
          </p>
          <p id="weatherSourceStatus" class="settings-source-status muted">Current source: live OpenWeather forecast</p>
          <p id="demoTabStatus" class="settings-source-status muted status-info">Ready for demo weather input.</p>
        </div>
      </section>
    </section>
  </main>

  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
  <script src="{% static 'js/app.js' %}"></script>
</body>
</html>
